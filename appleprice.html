<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Price Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            color: white;
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .header-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
        }
        
        .btn-primary {
            background: white;
            color: #667eea;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 5px 10px;
            font-size: 11px;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-delete-config {
            background: #f87171;
            color: white;
            padding: 4px 8px;
            font-size: 10px;
            margin-left: 8px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
        }
        
        .sidebar {
            background: #f8fafc;
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            cursor: pointer;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }
        
        .sidebar-header h2 {
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
        }
        
        .toggle-icon {
            font-size: 18px;
            transition: transform 0.3s ease;
        }
        
        .toggle-icon.collapsed {
            transform: rotate(-90deg);
        }
        
        .add-forms-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            overflow: hidden;
            max-height: 2000px;
            transition: max-height 0.3s ease;
        }
        
        .add-forms-container.collapsed {
            max-height: 0;
        }
        
        .add-form {
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .add-form h3 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #475569;
        }
        
        .form-group {
            margin-bottom: 8px;
        }
        
        .form-group label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #64748b;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            font-size: 13px;
            transition: border-color 0.2s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn-add {
            width: 100%;
            background: #667eea;
            color: white;
            padding: 8px;
            margin-top: 6px;
        }
        
        .btn-add:hover {
            background: #5568d3;
        }
        
        .data-area {
            padding: 12px;
            overflow-y: auto;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 15px;
            color: #94a3b8;
        }
        
        .empty-state svg {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
            opacity: 0.5;
        }
        
        .category-block {
            margin-bottom: 12px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .category-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .category-header h2 {
            font-size: 16px;
            font-weight: 700;
        }
        
        .model-item {
            border-bottom: 1px solid #e2e8f0;
        }
        
        .model-item:last-child {
            border-bottom: none;
        }
        
        .model-header {
            background: #f8fafc;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .model-header h3 {
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
        }
        
        .config-list {
            padding: 10px;
            background: #fefefe;
        }
        
        .config-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            margin-bottom: 8px;
            padding: 10px;
        }
        
        .config-header {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .price-inputs {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }
        
        .price-field {
            display: flex;
            flex-direction: column;
        }
        
        .price-field label {
            font-size: 10px;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 4px;
            text-transform: uppercase;
        }
        
        .price-field input {
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            font-size: 13px;
            font-weight: 600;
            width: 100%;
        }
        
        .price-field input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .toast {
            position: fixed;
            top: 15px;
            right: 15px;
            left: 15px;
            background: #10b981;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
            margin: 0 auto;
            font-size: 13px;
        }
        
        .toast.error {
            background: #ef4444;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 12px;
        }
        
        .modal-message {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 20px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .btn-modal-cancel {
            background: #e2e8f0;
            color: #475569;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-modal-confirm {
            background: #ef4444;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-modal-cancel:hover {
            background: #cbd5e1;
        }
        
        .btn-modal-confirm:hover {
            background: #dc2626;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        input[type="file"] {
            display: none;
        }

        /* Tablet –∏ Desktop */
        @media (min-width: 768px) {
            body {
                padding: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 26px;
            }
            
            .main-content {
                grid-template-columns: 280px 1fr;
            }
            
            .sidebar {
                border-bottom: none;
                border-right: 1px solid #e2e8f0;
                padding: 15px;
            }
            
            .data-area {
                padding: 15px;
            }
            
            .category-header h2 {
                font-size: 18px;
            }
            
            .model-header h3 {
                font-size: 15px;
            }
            
            .price-inputs {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .toast {
                right: 20px;
                left: auto;
            }
        }

        /* Large Desktop */
        @media (min-width: 1200px) {
            .config-item {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçé Apple Price Manager</h1>
            <div class="header-buttons">
                <input type="file" id="fileInput" accept=".json">
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å
                </button>
                <button class="btn btn-success" onclick="app.saveJSON()">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="sidebar-header" onclick="app.toggleSidebar()">
                    <h2>–î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã</h2>
                    <span class="toggle-icon" id="toggleIcon">‚ñº</span>
                </div>
                
                <div class="add-forms-container" id="addFormsContainer">
                    <div class="add-form">
                        <h3>‚ûï –ö–∞—Ç–µ–≥–æ—Ä–∏—è</h3>
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                            <input type="text" id="newCategoryName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: AirPods">
                        </div>
                        <button class="btn btn-add" onclick="app.addCategory()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                    
                    <div class="add-form">
                        <h3>‚ûï –ú–æ–¥–µ–ª—å</h3>
                        <div class="form-group">
                            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="modelCategory"></select>
                        </div>
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏</label>
                            <input type="text" id="newModelName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: AirPods Pro 2">
                        </div>
                        <button class="btn btn-add" onclick="app.addModel()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                    
                    <div class="add-form">
                        <h3>‚ûï –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h3>
                        <div class="form-group">
                            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="configCategory" onchange="app.updateModelSelect()"></select>
                        </div>
                        <div class="form-group">
                            <label>–ú–æ–¥–µ–ª—å</label>
                            <select id="configModel"></select>
                        </div>
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</label>
                            <input type="text" id="newConfigName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 128GB">
                        </div>
                        <div class="form-group">
                            <label>–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</label>
                            <input type="number" id="newConfigPrice" placeholder="0" min="0">
                        </div>
                        <button class="btn btn-add" onclick="app.addConfiguration()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
            </div>
            
            <div class="data-area" id="dataArea">
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <h2>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
                    <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON —Ñ–∞–π–ª –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const app = {
            priceData: {},
            
            init() {
                const fileInput = document.getElementById('fileInput');
                if (fileInput) {
                    fileInput.addEventListener('change', (e) => this.loadFile(e));
                }
            },
            
            toggleSidebar() {
                const container = document.getElementById('addFormsContainer');
                const icon = document.getElementById('toggleIcon');
                if (container && icon) {
                    container.classList.toggle('collapsed');
                    icon.classList.toggle('collapsed');
                }
            },
            
            showConfirm(message) {
                return new Promise((resolve) => {
                    const overlay = document.createElement('div');
                    overlay.className = 'modal-overlay';
                    
                    const modal = document.createElement('div');
                    modal.className = 'modal-content';
                    
                    const title = document.createElement('div');
                    title.className = 'modal-title';
                    title.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ';
                    
                    const msg = document.createElement('div');
                    msg.className = 'modal-message';
                    msg.textContent = message;
                    
                    const buttons = document.createElement('div');
                    buttons.className = 'modal-buttons';
                    
                    const cancelBtn = document.createElement('button');
                    cancelBtn.className = 'btn-modal-cancel';
                    cancelBtn.textContent = '–û—Ç–º–µ–Ω–∞';
                    cancelBtn.onclick = () => {
                        document.body.removeChild(overlay);
                        resolve(false);
                    };
                    
                    const confirmBtn = document.createElement('button');
                    confirmBtn.className = 'btn-modal-confirm';
                    confirmBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                    confirmBtn.onclick = () => {
                        document.body.removeChild(overlay);
                        resolve(true);
                    };
                    
                    buttons.appendChild(cancelBtn);
                    buttons.appendChild(confirmBtn);
                    
                    modal.appendChild(title);
                    modal.appendChild(msg);
                    modal.appendChild(buttons);
                    overlay.appendChild(modal);
                    
                    document.body.appendChild(overlay);
                });
            },
            
            loadFile(e) {
                const file = e.target.files[0];
                if (!file) {
                    this.showToast('–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω', true);
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (typeof data !== 'object' || data === null) {
                            throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö');
                        }
                        
                        this.priceData = data;
                        console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', this.priceData);
                        this.renderData();
                        this.updateSelects();
                        this.showToast('‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                    } catch (error) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', error);
                        this.showToast('‚ùå –û—à–∏–±–∫–∞: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON —Ñ–∞–π–ª', true);
                    }
                };
                
                reader.onerror = () => {
                    this.showToast('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', true);
                };
                
                reader.readAsText(file);
            },

            renderData() {
                const dataArea = document.getElementById('dataArea');
                
                if (!dataArea) {
                    console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç dataArea –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }
                
                if (!this.priceData || Object.keys(this.priceData).length === 0) {
                    dataArea.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <h2>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
                            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON —Ñ–∞–π–ª –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</p>
                        </div>
                    `;
                    return;
                }

                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                dataArea.innerHTML = '';
                
                for (const [category, models] of Object.entries(this.priceData)) {
                    if (!models || typeof models !== 'object') continue;
                    
                    const categoryBlock = document.createElement('div');
                    categoryBlock.className = 'category-block';
                    
                    const categoryHeader = document.createElement('div');
                    categoryHeader.className = 'category-header';
                    
                    const categoryTitle = document.createElement('h2');
                    categoryTitle.textContent = category;
                    
                    const deleteCategoryBtn = document.createElement('button');
                    deleteCategoryBtn.className = 'btn btn-danger';
                    deleteCategoryBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                    deleteCategoryBtn.onclick = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('üî¥ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', category);
                        this.deleteCategoryDirect(category);
                    };
                    
                    categoryHeader.appendChild(categoryTitle);
                    categoryHeader.appendChild(deleteCategoryBtn);
                    categoryBlock.appendChild(categoryHeader);
                    
                    for (const [model, configs] of Object.entries(models)) {
                        if (!configs || typeof configs !== 'object') continue;
                        
                        const modelItem = document.createElement('div');
                        modelItem.className = 'model-item';
                        
                        const modelHeader = document.createElement('div');
                        modelHeader.className = 'model-header';
                        
                        const modelTitle = document.createElement('h3');
                        modelTitle.textContent = model;
                        
                        const deleteModelBtn = document.createElement('button');
                        deleteModelBtn.className = 'btn btn-danger';
                        deleteModelBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                        deleteModelBtn.onclick = (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('üî¥ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —É–¥–∞–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–∏:', category, model);
                            this.deleteModelDirect(category, model);
                        };
                        
                        modelHeader.appendChild(modelTitle);
                        modelHeader.appendChild(deleteModelBtn);
                        
                        const configList = document.createElement('div');
                        configList.className = 'config-list';
                        
                        for (const [configName, prices] of Object.entries(configs)) {
                            if (!prices || typeof prices !== 'object') continue;
                            
                            const purchaseEntry = prices.purchase_entry !== undefined && prices.purchase_entry !== null ? prices.purchase_entry : 0;
                            const wholesaleSmall = prices.wholesale_small !== undefined && prices.wholesale_small !== null ? prices.wholesale_small : '';
                            const market = prices.market !== undefined && prices.market !== null ? prices.market : '';
                            
                            const configItem = document.createElement('div');
                            configItem.className = 'config-item';
                            
                            const configHeader = document.createElement('div');
                            configHeader.className = 'config-header';
                            
                            const configTitle = document.createElement('span');
                            configTitle.textContent = configName;
                            
                            const deleteConfigBtn = document.createElement('button');
                            deleteConfigBtn.className = 'btn btn-delete-config';
                            deleteConfigBtn.textContent = '‚úï';
                            deleteConfigBtn.onclick = (e) => {
                                e.preventDefault();
                                e.stopPropagation();
                                console.log('üî¥ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:', category, model, configName);
                                this.deleteConfigDirect(category, model, configName);
                            };
                            
                            configHeader.appendChild(configTitle);
                            configHeader.appendChild(deleteConfigBtn);
                            
                            const priceInputs = document.createElement('div');
                            priceInputs.className = 'price-inputs';
                            
                            // –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞
                            const field1 = document.createElement('div');
                            field1.className = 'price-field';
                            field1.innerHTML = '<label>üí∞ –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</label>';
                            const input1 = document.createElement('input');
                            input1.type = 'number';
                            input1.value = purchaseEntry;
                            input1.min = '0';
                            input1.required = true;
                            input1.onchange = (e) => this.updatePriceDirect(category, model, configName, 'purchase_entry', e.target.value);
                            field1.appendChild(input1);
                            
                            // –ú–µ–ª–∫–∏–π –æ–ø—Ç
                            const field2 = document.createElement('div');
                            field2.className = 'price-field';
                            field2.innerHTML = '<label>üì¶ –ú–µ–ª–∫–∏–π –æ–ø—Ç</label>';
                            const input2 = document.createElement('input');
                            input2.type = 'number';
                            input2.value = wholesaleSmall;
                            input2.min = '0';
                            input2.placeholder = '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                            input2.onchange = (e) => this.updatePriceDirect(category, model, configName, 'wholesale_small', e.target.value);
                            field2.appendChild(input2);
                            
                            // –†—ã–Ω–æ—á–Ω–∞—è
                            const field3 = document.createElement('div');
                            field3.className = 'price-field';
                            field3.innerHTML = '<label>üè™ –†—ã–Ω–æ—á–Ω–∞—è</label>';
                            const input3 = document.createElement('input');
                            input3.type = 'number';
                            input3.value = market;
                            input3.min = '0';
                            input3.placeholder = '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                            input3.onchange = (e) => this.updatePriceDirect(category, model, configName, 'market', e.target.value);
                            field3.appendChild(input3);
                            
                            priceInputs.appendChild(field1);
                            priceInputs.appendChild(field2);
                            priceInputs.appendChild(field3);
                            
                            configItem.appendChild(configHeader);
                            configItem.appendChild(priceInputs);
                            configList.appendChild(configItem);
                        }
                        
                        modelItem.appendChild(modelHeader);
                        modelItem.appendChild(configList);
                        categoryBlock.appendChild(modelItem);
                    }
                    
                    dataArea.appendChild(categoryBlock);
                }
                
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω—ã');
            },

            escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = String(text);
                return div.innerHTML;
            },

            escapeForJs(text) {
                if (!text) return '';
                return String(text).replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/'/g, "\\'");
            },

            updatePriceDirect(category, model, config, field, value) {
                if (!this.priceData[category] || !this.priceData[category][model] || !this.priceData[category][model][config]) {
                    console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –¥–∞–Ω–Ω—ã—Ö');
                    return;
                }
                
                const numValue = value === '' || value === null ? null : Number(value);
                
                if (numValue !== null && isNaN(numValue)) {
                    this.showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ', true);
                    return;
                }
                
                if (numValue !== null && numValue < 0) {
                    this.showToast('‚ùå –¶–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π', true);
                    return;
                }
                
                this.priceData[category][model][config][field] = numValue;
                console.log('‚úÖ –¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞:', category, model, config, field, '=', numValue);
            },

            deleteCategoryDirect(category) {
                console.log('üóëÔ∏è –ü–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é:', category);
                
                if (!category) {
                    console.error('‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞');
                    return;
                }
                
                if (!this.priceData[category]) {
                    console.error('‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', category);
                    this.showToast('‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', true);
                    return;
                }
                
                this.showConfirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${category}" —Å–æ –≤—Å–µ–º–∏ –º–æ–¥–µ–ª—è–º–∏?`).then((confirmed) => {
                    if (!confirmed) {
                        console.log('‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º');
                        return;
                    }
                    
                    delete this.priceData[category];
                    console.log('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞:', category);
                    this.renderData();
                    this.updateSelects();
                    this.showToast('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞');
                });
            },

            deleteModelDirect(category, model) {
                console.log('üóëÔ∏è –ü–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å –º–æ–¥–µ–ª—å:', category, model);
                
                if (!category || !model) {
                    console.error('‚ùå –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã');
                    return;
                }
                
                if (!this.priceData[category] || !this.priceData[category][model]) {
                    console.error('‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', category, model);
                    this.showToast('‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', true);
                    return;
                }
                
                this.showConfirm(`–£–¥–∞–ª–∏—Ç—å –º–æ–¥–µ–ª—å "${model}"?`).then((confirmed) => {
                    if (!confirmed) {
                        console.log('‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º');
                        return;
                    }
                    
                    delete this.priceData[category][model];
                    console.log('‚úÖ –ú–æ–¥–µ–ª—å —É–¥–∞–ª–µ–Ω–∞:', model);
                    this.renderData();
                    this.updateSelects();
                    this.showToast('‚úÖ –ú–æ–¥–µ–ª—å —É–¥–∞–ª–µ–Ω–∞');
                });
            },

            deleteConfigDirect(category, model, config) {
                console.log('üóëÔ∏è –ü–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:', category, model, config);
                
                if (!category || !model || !config) {
                    console.error('‚ùå –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã');
                    return;
                }
                
                if (!this.priceData[category] || 
                    !this.priceData[category][model] || 
                    !this.priceData[category][model][config]) {
                    console.error('‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', category, model, config);
                    this.showToast('‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', true);
                    return;
                }
                
                this.showConfirm(`–£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é "${config}"?`).then((confirmed) => {
                    if (!confirmed) {
                        console.log('‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º');
                        return;
                    }
                    
                    delete this.priceData[category][model][config];
                    console.log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞:', config);
                    this.renderData();
                    this.showToast('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞');
                });
            },

            addCategory() {
                const input = document.getElementById('newCategoryName');
                if (!input) return;
                
                const name = input.value.trim();
                if (!name) {
                    this.showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', true);
                    return;
                }
                if (this.priceData[name]) {
                    this.showToast('‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', true);
                    return;
                }
                
                this.priceData[name] = {};
                input.value = '';
                this.renderData();
                this.updateSelects();
                this.showToast('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            },

            addModel() {
                const categorySelect = document.getElementById('modelCategory');
                const nameInput = document.getElementById('newModelName');
                
                if (!categorySelect || !nameInput) return;
                
                const category = categorySelect.value;
                const name = nameInput.value.trim();
                
                if (!category) {
                    this.showToast('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', true);
                    return;
                }
                if (!name) {
                    this.showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏', true);
                    return;
                }
                if (!this.priceData[category]) {
                    this.showToast('‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', true);
                    return;
                }
                if (this.priceData[category][name]) {
                    this.showToast('‚ùå –ú–æ–¥–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', true);
                    return;
                }
                
                this.priceData[category][name] = {};
                nameInput.value = '';
                this.renderData();
                this.updateSelects();
                this.showToast('‚úÖ –ú–æ–¥–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            },

            addConfiguration() {
                const categorySelect = document.getElementById('configCategory');
                const modelSelect = document.getElementById('configModel');
                const nameInput = document.getElementById('newConfigName');
                const priceInput = document.getElementById('newConfigPrice');
                
                if (!categorySelect || !modelSelect || !nameInput || !priceInput) return;
                
                const category = categorySelect.value;
                const model = modelSelect.value;
                const name = nameInput.value.trim();
                const price = Number(priceInput.value) || 0;
                
                if (!category || !model) {
                    this.showToast('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –º–æ–¥–µ–ª—å', true);
                    return;
                }
                if (!name) {
                    this.showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', true);
                    return;
                }
                if (!this.priceData[category] || !this.priceData[category][model]) {
                    this.showToast('‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', true);
                    return;
                }
                if (this.priceData[category][model][name]) {
                    this.showToast('‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', true);
                    return;
                }
                if (price < 0) {
                    this.showToast('‚ùå –¶–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π', true);
                    return;
                }
                
                this.priceData[category][model][name] = {
                    purchase_entry: price,
                    wholesale_small: null,
                    market: null
                };
                
                nameInput.value = '';
                priceInput.value = '';
                this.renderData();
                this.showToast('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            },

            updateSelects() {
                const categories = Object.keys(this.priceData || {});
                
                const modelCategorySelect = document.getElementById('modelCategory');
                const configCategorySelect = document.getElementById('configCategory');
                
                if (modelCategorySelect) {
                    modelCategorySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>' +
                        categories.map(cat => `<option value="${this.escapeHtml(cat)}">${this.escapeHtml(cat)}</option>`).join('');
                }
                
                if (configCategorySelect) {
                    configCategorySelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>' +
                        categories.map(cat => `<option value="${this.escapeHtml(cat)}">${this.escapeHtml(cat)}</option>`).join('');
                }
                
                this.updateModelSelect();
            },

            updateModelSelect() {
                const categorySelect = document.getElementById('configCategory');
                const modelSelect = document.getElementById('configModel');
                
                if (!categorySelect || !modelSelect) return;
                
                const category = categorySelect.value;
                
                if (!category || !this.priceData[category]) {
                    modelSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>';
                    return;
                }
                
                const models = Object.keys(this.priceData[category]);
                modelSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>' +
                    models.map(model => `<option value="${this.escapeHtml(model)}">${this.escapeHtml(model)}</option>`).join('');
            },

            saveJSON() {
                if (!this.priceData || Object.keys(this.priceData).length === 0) {
                    this.showToast('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', true);
                    return;
                }
                
                try {
                    const json = JSON.stringify(this.priceData, null, 2);
                    const blob = new Blob([json], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    
                    const date = new Date();
                    const dateStr = date.toISOString().split('T')[0];
                    a.download = `price-config-${dateStr}.json`;
                    
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showToast('‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                    this.showToast('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞', true);
                }
            },

            showToast(message, isError = false) {
                const existingToasts = document.querySelectorAll('.toast');
                existingToasts.forEach(t => t.remove());
                
                const toast = document.createElement('div');
                toast.className = 'toast' + (isError ? ' error' : '');
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
        };

        // –î–µ–ª–∞–µ–º app –≥–ª–æ–±–∞–ª—å–Ω—ã–º
        window.app = app;

        document.addEventListener('DOMContentLoaded', () => {
            app.init();
            console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
        });
    </script>
</body>
</html>