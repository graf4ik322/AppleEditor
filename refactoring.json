{
  "task": "react_refactoring",
  "project_name": "Apple Price Manager",
  "objective": "Полный рефакторинг существующего Vanilla JavaScript приложения в современное React приложение с использованием shadcn/ui, Tailwind CSS и лучших практик разработки",
  
  "current_project": {
    "description": "Локальный прайс-менеджер Apple-устройств - Single Page Application для просмотра, редактирования и управления прайс-листами устройств Apple",
    "current_stack": {
      "frontend": "Vanilla JavaScript (ES6+)",
      "styling": "CSS3 + Tailwind CSS CDN",
      "data_storage": "JSON файл (локальный)",
      "architecture": "Single HTML file with embedded CSS and JavaScript",
      "components": "Native DOM manipulation"
    },
    "file_structure": {
      "current": [
        "index.html - единственный файл приложения",
        "Embedded CSS в <style> теге",
        "Embedded JavaScript в <script> теге",
        "price-config.json - внешний файл с данными"
      ]
    },
    "key_features": [
      "Загрузка JSON файла через file input",
      "Отображение иерархии: Category → Model → Configuration",
      "Редактирование трёх типов цен: purchase_entry, wholesale_small, market",
      "Добавление новых категорий, моделей и конфигураций",
      "Удаление элементов с кастомным модальным подтверждением",
      "Сохранение изменений в новый JSON файл (download)",
      "Сворачиваемое боковое меню для добавления элементов",
      "Toast-уведомления об успехе/ошибках",
      "Полная адаптивность (mobile-first подход)",
      "Компактный дизайн с минимальными отступами"
    ],
    "current_implementation": {
      "state_management": "Объект app.priceData хранит все данные в памяти",
      "rendering": "Программное создание DOM элементов через createElement()",
      "event_handlers": "onclick callbacks с прямой привязкой к методам app объекта",
      "validation": "Клиентская валидация: проверка на пустые поля, отрицательные числа, дубликаты",
      "modal_system": "Кастомное модальное окно через Promise для подтверждения удаления",
      "responsive_design": "Media queries для 320px+, 768px+, 1200px+"
    },
    "current_problems": [
      "Нет компонентной архитектуры",
      "Сложность масштабирования",
      "Отсутствие типизации",
      "Монолитный код в одном файле",
      "Ограниченные возможности UI компонентов",
      "Нет системы сборки и оптимизации"
    ]
  },

  "data_structure": {
    "description": "Иерархическая JSON структура для хранения прайс-листов",
    "schema": {
      "type": "object",
      "structure": "Category → Model → Configuration → Prices",
      "example": {
        "Apple Watch": {
          "Apple Watch Ultra 3": {
            "default": {
              "purchase_entry": 48000,
              "wholesale_small": null,
              "market": null
            }
          },
          "Apple Watch Series 11 42mm": {
            "default": {
              "purchase_entry": 23000,
              "wholesale_small": null,
              "market": null
            }
          }
        },
        "iPhone": {
          "iPhone 17 Pro Max": {
            "256GB (SIM + eSIM)": {
              "purchase_entry": 90000,
              "wholesale_small": null,
              "market": null
            },
            "512GB (SIM + eSIM)": {
              "purchase_entry": 105000,
              "wholesale_small": null,
              "market": null
            }
          },
          "iPhone 17": {
            "256GB (eSIM)": {
              "purchase_entry": 55000,
              "wholesale_small": null,
              "market": null
            }
          }
        },
        "iPad": {
          "iPad Air 11-inch (2025, Wi-Fi)": {
            "256GB": {
              "purchase_entry": 45000,
              "wholesale_small": null,
              "market": null
            }
          }
        },
        "MacBook": {
          "MacBook Air 15-inch (2025, M4)": {
            "16GB / 256GB": {
              "purchase_entry": 75000,
              "wholesale_small": null,
              "market": null
            }
          }
        }
      }
    },
    "price_fields": {
      "purchase_entry": {
        "type": "number",
        "required": true,
        "description": "Цена входа (закупочная)",
        "validation": "≥ 0"
      },
      "wholesale_small": {
        "type": "number | null",
        "required": false,
        "description": "Цена мелкого опта",
        "validation": "≥ 0 или null"
      },
      "market": {
        "type": "number | null",
        "required": false,
        "description": "Рыночная цена",
        "validation": "≥ 0 или null"
      }
    }
  },

  "original_requirements": {
    "format": "Single Page Application (SPA)",
    "work_mode": "Локально (без backend, без интернета при использовании)",
    "goals": [
      "Просмотр прайс-листа устройств Apple",
      "Редактирование существующих моделей, конфигураций и цен",
      "Добавление новых моделей и конфигураций",
      "Сохранение всех изменений в отдельный JSON-файл",
      "Последующее использование JSON как источника данных для других систем (CRM, Telegram-бот, API, Excel-импорт)"
    ],
    "constraints": [
      "Без backend/сервера в production",
      "Данные хранятся только в JSON",
      "Работа в браузерах: Chrome, Edge, Firefox",
      "Прямая перезапись файлов на диске невозможна - используется схема: загрузка → редактирование → сохранение (download)"
    ],
    "ui_requirements": {
      "style": "Минималистичный, компактный",
      "hierarchy": "Чёткая визуальная иерархия",
      "responsive": "Полная адаптация под все устройства (mobile-first)",
      "spacing": "Компактные отступы, эффективное использование пространства"
    },
    "functional_requirements": [
      "Загрузка данных: пользователь загружает JSON файл с диска",
      "Отображение: иерархия Category → Model → Configuration → Prices",
      "Редактирование: изменения применяются сразу в памяти с визуальной обратной связью",
      "Добавление: формы для добавления категорий, моделей, конфигураций с валидацией",
      "Удаление: удаление элементов с подтверждением",
      "Сохранение: экспорт в JSON файл с форматированием и датой в имени файла",
      "Валидация: проверка на пустые названия, отрицательные цены, дубликаты, валидность JSON"
    ]
  },

  "target_stack": {
    "framework": "React 18+",
    "build_tool": "Vite",
    "language": "TypeScript (предпочтительно) или JavaScript",
    "ui_library": "shadcn/ui",
    "styling": "Tailwind CSS",
    "icons": "lucide-react",
    "state_management": "React hooks (useState, useReducer, useContext)",
    "utilities": [
      "clsx - для условных классов",
      "tailwind-merge - для мержа Tailwind классов"
    ]
  },

  "target_architecture": {
    "folder_structure": {
      "/": "Корень проекта",
      "/src": "Исходный код",
      "/src/components": "React компоненты",
      "/src/components/ui": "shadcn/ui компоненты",
      "/src/lib": "Утилиты и хелперы",
      "/src/hooks": "Кастомные React hooks",
      "/src/types": "TypeScript типы (если используется TS)",
      "/public": "Статические файлы"
    },
    "component_structure": [
      {
        "name": "App.tsx/jsx",
        "description": "Главный компонент приложения",
        "responsibilities": [
          "Управление состоянием priceData",
          "Обработка загрузки/сохранения JSON",
          "Координация между компонентами"
        ]
      },
      {
        "name": "Header",
        "description": "Шапка приложения с кнопками управления",
        "props": ["onLoadFile", "onSaveFile", "hasData"],
        "ui_elements": ["Button из shadcn/ui"]
      },
      {
        "name": "Sidebar",
        "description": "Боковая панель с формами добавления",
        "props": ["categories", "onAddCategory", "onAddModel", "onAddConfig"],
        "features": ["Сворачиваемость", "Формы с валидацией"],
        "ui_elements": ["Input", "Select", "Button", "Label", "Collapsible"]
      },
      {
        "name": "CategoryBlock",
        "description": "Блок отображения категории",
        "props": ["category", "models", "onDeleteCategory", "onUpdatePrice", "onDeleteModel"],
        "ui_elements": ["Card", "Button", "AlertDialog для подтверждения"]
      },
      {
        "name": "ModelItem",
        "description": "Элемент модели внутри категории",
        "props": ["model", "configs", "onDeleteModel", "onUpdatePrice"],
        "ui_elements": ["Collapsible для сворачивания конфигураций"]
      },
      {
        "name": "ConfigItem",
        "description": "Конфигурация с полями цен",
        "props": ["config", "prices", "onUpdatePrice", "onDeleteConfig"],
        "ui_elements": ["Input для number", "Label"]
      },
      {
        "name": "AddCategoryForm",
        "description": "Форма добавления категории",
        "props": ["onAdd"],
        "validation": ["Не пустое", "Уникальность"]
      },
      {
        "name": "AddModelForm",
        "description": "Форма добавления модели",
        "props": ["categories", "onAdd"],
        "validation": ["Выбрана категория", "Не пустое название", "Уникальность"]
      },
      {
        "name": "AddConfigForm",
        "description": "Форма добавления конфигурации",
        "props": ["categories", "models", "onAdd"],
        "validation": ["Выбраны категория и модель", "Не пустое название", "Цена ≥ 0"]
      },
      {
        "name": "ConfirmDialog",
        "description": "Модальное окно подтверждения действия",
        "props": ["open", "onOpenChange", "onConfirm", "title", "message"],
        "ui_elements": ["AlertDialog из shadcn/ui"]
      },
      {
        "name": "Toast",
        "description": "Уведомления",
        "implementation": "useToast hook из shadcn/ui или react-hot-toast"
      },
      {
        "name": "EmptyState",
        "description": "Состояние пустого списка",
        "props": ["message", "icon"]
      }
    ]
  },

  "shadcn_components_needed": [
    "button",
    "input",
    "label",
    "select",
    "card",
    "alert-dialog",
    "collapsible",
    "toast",
    "separator"
  ],

  "key_features_implementation": {
    "file_upload": {
      "approach": "Input type='file' с accept='.json'",
      "handling": "FileReader API → JSON.parse → setState",
      "error_handling": "try-catch с toast уведомлением"
    },
    "data_display": {
      "approach": "Рекурсивный рендеринг компонентов",
      "optimization": "React.memo для предотвращения лишних ререндеров",
      "structure": "CategoryBlock → ModelItem → ConfigItem"
    },
    "price_editing": {
      "approach": "Controlled inputs с onChange",
      "debouncing": "Опционально для производительности",
      "validation": "Real-time валидация в onChange"
    },
    "adding_items": {
      "forms": "Отдельные компоненты форм с локальным состоянием",
      "validation": "Проверка перед добавлением",
      "clearing": "Сброс формы после успешного добавления"
    },
    "deleting_items": {
      "confirmation": "AlertDialog из shadcn/ui",
      "cascade": "При удалении категории удаляются все вложенные модели"
    },
    "file_save": {
      "approach": "Blob API + URL.createObjectURL + createElement('a')",
      "filename": "price-config-{date}.json",
      "formatting": "JSON.stringify с 2 пробелами отступа"
    },
    "state_management": {
      "main_state": "useState для priceData объекта",
      "updates": "Иммутабельные обновления через spread operator",
      "alternative": "useReducer для сложной логики (опционально)"
    },
    "responsive_design": {
      "approach": "Tailwind responsive префиксы (sm:, md:, lg:)",
      "sidebar": "Collapsible на мобильных, fixed на desktop",
      "grid": "grid-cols-1 на mobile, grid-cols-3 на desktop для цен"
    }
  },

  "styling_guidelines": {
    "color_scheme": {
      "primary": "Gradient purple (#667eea → #764ba2)",
      "success": "#10b981",
      "danger": "#ef4444",
      "background": "#f8fafc",
      "text": "#1e293b"
    },
    "spacing": {
      "compact": true,
      "gaps": "gap-2 (8px), gap-3 (12px), gap-4 (16px)",
      "padding": "p-2 (8px), p-3 (12px), p-4 (16px)"
    },
    "borders": {
      "radius": "rounded-md (6px), rounded-lg (8px), rounded-xl (12px)",
      "colors": "border-slate-200"
    },
    "shadows": {
      "cards": "shadow-sm",
      "modals": "shadow-2xl"
    }
  },

  "typescript_types": {
    "if_using_typescript": true,
    "types_needed": [
      {
        "name": "PriceConfig",
        "definition": {
          "purchase_entry": "number",
          "wholesale_small": "number | null",
          "market": "number | null"
        }
      },
      {
        "name": "Configuration",
        "definition": {
          "[key: string]": "PriceConfig"
        }
      },
      {
        "name": "Model",
        "definition": {
          "[key: string]": "Configuration"
        }
      },
      {
        "name": "Category",
        "definition": {
          "[key: string]": "Model"
        }
      },
      {
        "name": "PriceData",
        "definition": {
          "[key: string]": "Category"
        }
      }
    ]
  },

  "custom_hooks": [
    {
      "name": "useJsonFile",
      "purpose": "Управление загрузкой и сохранением JSON",
      "returns": ["loadFile", "saveFile", "isLoading", "error"]
    },
    {
      "name": "usePriceData",
      "purpose": "Управление состоянием priceData",
      "returns": ["priceData", "updatePrice", "addCategory", "addModel", "addConfig", "deleteCategory", "deleteModel", "deleteConfig"]
    },
    {
      "name": "useConfirm",
      "purpose": "Модальное подтверждение действий",
      "returns": ["confirm", "ConfirmDialog"]
    }
  ],

  "validation_rules": {
    "category_name": [
      "Не пустое",
      "Уникальное в рамках всех категорий"
    ],
    "model_name": [
      "Не пустое",
      "Уникальное в рамках категории"
    ],
    "config_name": [
      "Не пустое",
      "Уникальное в рамках модели"
    ],
    "prices": [
      "Числовой тип",
      "≥ 0",
      "purchase_entry обязательное",
      "wholesale_small и market опциональные (могут быть null)"
    ],
    "json_file": [
      "Валидный JSON",
      "Соответствует структуре данных",
      "Обработка ошибок парсинга"
    ]
  },

  "performance_optimizations": [
    "React.memo для компонентов списков",
    "useMemo для дорогих вычислений",
    "useCallback для стабильных функций-коллбэков",
    "Виртуализация списков (react-window) если >100 элементов",
    "Debounce для поиска (если будет добавлен)"
  ],

  "build_and_deploy": {
    "development": {
      "command": "npm run dev",
      "port": "5173 (Vite default)",
      "hot_reload": true
    },
    "production": {
      "build_command": "npm run build",
      "output_dir": "dist/",
      "optimization": [
        "Минификация JS/CSS",
        "Tree-shaking",
        "Code splitting",
        "Asset optimization"
      ]
    },
    "deployment_targets": [
      "Vercel (рекомендуется)",
      "Netlify",
      "GitHub Pages",
      "Обычный хостинг (копирование dist/)"
    ]
  },

  "testing_strategy": {
    "unit_tests": "Vitest или Jest для утилит и hooks",
    "component_tests": "React Testing Library",
    "e2e_tests": "Playwright или Cypress (опционально)",
    "critical_scenarios": [
      "Загрузка валидного JSON",
      "Загрузка невалидного JSON",
      "Добавление элементов с валидацией",
      "Удаление элементов",
      "Редактирование цен",
      "Сохранение JSON"
    ]
  },

  "documentation": {
    "readme": [
      "Описание проекта",
      "Установка зависимостей",
      "Запуск в dev режиме",
      "Сборка для production",
      "Деплой инструкции",
      "Структура проекта"
    ],
    "code_comments": "Комментарии для сложной логики",
    "jsdoc": "Для публичных функций и компонентов (если не TypeScript)"
  },

  "future_enhancements": {
    "planned_features": [
      "Поиск по моделям",
      "Сортировка",
      "Фильтрация",
      "Экспорт в CSV/XLSX",
      "Импорт из CSV/XLSX",
      "Поддержка валют",
      "Расчёт маржи",
      "История изменений (localStorage)",
      "Dark mode",
      "Multi-language support"
    ],
    "backend_integration": {
      "when_needed": "При необходимости синхронизации между пользователями",
      "options": [
        "REST API",
        "GraphQL",
        "Firebase/Supabase",
        "Telegram Bot API"
      ]
    }
  },

  "success_criteria": [
    "✅ Все функции текущей версии работают",
    "✅ Код организован в компонентную архитектуру",
    "✅ Используются shadcn/ui компоненты",
    "✅ Полная адаптивность сохранена",
    "✅ Компактный дизайн реализован",
    "✅ TypeScript типы (если используется TS)",
    "✅ Код легко расширяем",
    "✅ Готов к деплою на Vercel/Netlify",
    "✅ Документация написана",
    "✅ Нет критичных багов"
  ],

  "additional_notes": [
    "Сохранить логику работы с JSON файлами (загрузка/сохранение через браузер)",
    "Сохранить кастомное модальное окно подтверждения (или использовать AlertDialog из shadcn)",
    "Сохранить компактность дизайна - это было важное требование",
    "Сохранить все три поля цен с правильной обработкой null значений",
    "Убедиться, что кнопки удаления работают корректно (была проблема в текущей версии)",
    "Добавить логирование для отладки (console.log с эмодзи)",
    "Настроить .gitignore (node_modules, dist, .env)",
    "Добавить .env.example если будут переменные окружения"
  ],

  "delivery_format": {
    "structure": "Полный рабочий проект",
    "files": [
      "package.json с зависимостями",
      "Все компоненты в отдельных файлах",
      "Настроенный Tailwind и shadcn/ui",
      "README.md с инструкциями",
      "Пример price-config.json",
      ".gitignore"
    ],
    "instructions": "Пошаговая инструкция по запуску и деплою"
  }
}